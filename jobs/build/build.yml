---
- name: Install missing apt packages
  apt:
    pkg:
      - gcc
      - make
      - libiperf0
      - libssl-dev
      - openssl
- name: Create iperf3 binary
  include_tasks:
    file: build-iperf3.yml
- name: Make sure app directories are built
  ansible.builtin.file:
    path: "{{ item }}"
    mode: '0744'
    owner: "{{ run.user }}"
    group: "{{ run.user }}"
    recurse: true
    state: directory
  loop:
    - /opt/penguinperf3
    - /opt/results
- name: Make sure web directory is built
  ansible.builtin.file:
    path: /var/www/penguinperf3
    mode: '0744'
    owner: "{{ run.user }}"
    group: "{{ run.user }}"
    state: directory
    recurse: true
- name: give edit rights to startup
  ansible.builtin.file:
    path: /opt/manager/bins/server.sh
    mode: '0755'
    owner: "{{ run.user }}"
    group: "{{ run.user }}"
- name: Copy sudoers
  ansible.builtin.copy:
    src: "{{ playbook_dir }}/data/sudoers"
    dest: /etc/sudoers
- name: Create blank log file
  copy:
    content: ""
    dest: /var/www/penguinperf3/results.log
    force: false
    owner: "{{ run.user }}"
    group: "{{ run.user }}"
